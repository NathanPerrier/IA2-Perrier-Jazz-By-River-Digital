{% extends 'atc_site/template/dashboard.html' %} 
{% load static %} 
{% load user_filters %}
{% load date_extras %}
{% block content %}

<div class="container-fluid py-4">
  <div class="row">
    <div class="col-xl-8 col-lg-7">
      <div class="row">
        <div class="col-sm-4">
          <div class="card overflow-hidden">
            <div class="card-header p-3 pb-0">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">
                Customers
              </p>
              <h5 class="font-weight-bolder mb-0">
                {{ customers|length|default:"0" }}
                <span class="text-success text-sm font-weight-bolder"
                  >{{customers_percentage_increase}}</span
                >
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="chart">
                <canvas
                  id="chart-line-1"
                  class="chart-canvas"
                  height="100"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-4 mt-sm-0 mt-4">
          <div class="card overflow-hidden">
            <div class="card-header p-3 pb-0">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">
                Income
              </p>
              <h5 class="font-weight-bolder mb-0">
                ${{income}}
                <span class="text-success text-sm font-weight-bolder"
                  >+95%</span
                >
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="chart">
                <canvas
                  id="chart-line-2"
                  class="chart-canvas"
                  height="100"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-4 mt-sm-0 mt-4">
          <div class="card overflow-hidden">
            <div class="card-header p-3 pb-0">
              <p class="text-sm mb-0 text-capitalize font-weight-bold">
                Bookings
              </p>
              <h5 class="font-weight-bolder mb-0">
                {{bookings|length|default:"0"}}
                <span class="text-success text-sm font-weight-bolder"
                  >+90%</span
                >
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="chart">
                <canvas
                  id="chart-line-3"
                  class="chart-canvas"
                  height="100"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div class="card widget-calendar h-100">
            <div class="card-header p-3 pb-0">
              <h6 class="mb-0">Ticket Sale Calendar</h6>
              <div class="d-flex">
                <div
                  class="p text-sm font-weight-bold mb-0 widget-calendar-day"
                ></div>
                <span>,&nbsp;</span>
                <div
                  class="p text-sm font-weight-bold mb-1 widget-calendar-year"
                ></div>
              </div>
            </div>

            <div class="card-body p-3">
              <div data-toggle="widget-calendar"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row mt-4">
      <div class="col-sm-6">
        <div class="card h-100">
          <div class="card-header pb-0 p-3">
            <div class="row">
              <div class="col-md-6">
                <h6 class="mb-0">Invoices</h6>
              </div>
              <div class="col-md-6 d-flex justify-content-end align-items-center">
                <a href="/admin/dashboard/stripe/invoices/"><small class="text-secondary">View More</small>
                <i class="fa fa-arrow-right me-2 ms-2 text-secondary"></i></a>
              </div>
            </div>
          </div>
          <div class="card-body p-3">
            <ul class="list-group">
              {% if last_3_transactions|length == 0 %}
                <li class="list-group-item border-0 justify-content-between ps-0 pb-0 border-radius-lg">
                  <div class="d-flex">
                    <div class="d-flex align-items-center">
                      <div class="d-flex flex-column">
                        <h6 class="mb-1 text-dark text-sm">No Current Invoices</h6>
                      </div>
                    </div>
                  </div>
                  <hr class="horizontal dark mt-3 mb-2" />
                </li>
              {% endif %}
              {% for transaction in last_3_transactions %}
                <a href="{{transaction.hosted_invoice_url}}"><li class="list-group-item border-0 justify-content-between ps-0 pb-0 border-radius-lg">
                  <div class="d-flex">
                    <div class="d-flex align-items-center">
                      <button class="btn btn-icon-only btn-rounded btn-outline-success mb-0 me-3 p-3 btn-sm d-flex align-items-center justify-content-center">
                        <i class="fas fa-arrow-up"></i>
                      </button>
                      <div class="d-flex flex-column">
                        <h6 class="mb-0 text-dark text-sm">{{ transaction.customer_name}}</h6>
                        <!-- view order button -->
                        <small class="text-xs mt-0 text-dark mb-1">{{ transaction.customer_email|capfirst }}</small>
                        <span class="text-xs text-dark">{{  transaction.created|add_date|date:"F j, Y" }}, at {{  transaction.created|add_date|date:"H:i:s" }}</span>
                      </div>
                    </div>
                    <div class="d-flex align-items-center text-success text-gradient text-sm font-weight-bold ms-auto">
                      ${{ transaction.subtotal|div:100 }}
                    </div>
                  </div>
                  <hr class="horizontal dark mt-3 mb-2" />
                </li></a>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      <div class="col-sm-6 mt-sm-0 mt-4">

        <div class="card p-3 h-100">
          <div
            class="overflow-hidden position-relative border-radius-lg bg-cover h-100 bg-overlay-55"
            style="background-image: url('{{top_selling_event.image.url}}');"
          >
            <span class="mask bg-gradient-dark"></span>
            <div class="card-body position-relative z-index-1 h-100 p-3">
              <h6 class="text-white font-weight-bolder mb-3">
                Current Best Selling Event
              </h6>
              <p class="text-white mb-3">
                {{ top_selling_event.description }}
              </p>
              <div class="d-flex align-items-end">
                <a
                  class="btn btn-round btn-outline-white mb-0"
                  href="/events/{{ top_selling_event.id }}/"
                >
                  Read More
                  <i
                    class="fas fa-arrow-right text-sm ms-1"
                    aria-hidden="true"
                  ></i>
                </a>
                <div class="ms-auto">
                  <div class="btn disabled btn-round btn-outline-white mb-0">
                    {{ top_selling_event.sold }} Sold
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    <div class="row" style="z-index:-100">
      <div class="col-12">
        <div id="globe" class="position-absolute end-0 top-10 mt-sm-3 mt-7 me-lg-7 peekaboo">
          <canvas width="700" height="654" class="w-lg-100 h-lg-100 w-75 h-75 me-lg-0 me-n10 mt-lg-5" style="width: 700px; height: 654.6px;"></canvas>
        </div>
      </div>
    </div>
    {% endblock %}
  </div>
</div>


{% block scripts %}

{% endblock %}