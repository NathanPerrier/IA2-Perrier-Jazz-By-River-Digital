
{% extends 'atc_site/template/vendor_dashboard.html' %} 
{% load static %} 
{% load user_filters %}
{% block content %}


<div class="container-fluid py-4">
    <div class="d-sm-flex justify-content-between">
        <div class="d-flex">
            <div class="dropdown d-inline">
                <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle " data-bs-toggle="dropdown" id="navbarDropdownMenuLink2">
                    Filters
                </a>
                <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="navbarDropdownMenuLink2" data-popper-placement="left-start">
                    <li><a class="dropdown-item border-radius-md" href="javascript:;">Status: Paid</a></li>
                    <li><a class="dropdown-item border-radius-md" href="javascript:;">Status: Refunded</a></li>
                    <li><a class="dropdown-item border-radius-md" href="javascript:;">Status: Canceled</a></li>
                    <li>
                        <hr class="horizontal dark my-2">
                    </li>
                    <li><a class="dropdown-item border-radius-md text-danger" href="javascript:;">Remove Filter</a></li>
                </ul>
            </div>
            <button class="btn btn-icon btn-outline-dark ms-2 export" data-type="csv" type="button">
                <span class="btn-inner--icon"><i class="ni ni-archive-2"></i></span>
                <span class="btn-inner--text">Export CSV</span>
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="table-responsive">
                    <div class="dataTable-wrapper dataTable-loading no-footer sortable searchable fixed-columns"><div class="dataTable-top"><div class="dataTable-search"><input class="dataTable-input" placeholder="Search..." type="text"></div></div><div class="dataTable-container"><table class="table table-flush dataTable-table" id="datatable-search">
                        <thead class="thead-light">
                            <tr><th data-sortable="" style="width: 9.4145%;"><a href="#" class="dataTable-sorter">Id</a></th><th data-sortable="" style="width: 21.5716%;"><a href="#" class="dataTable-sorter">Order Date</a></th><th data-sortable="" style="width: 21.1094%;"><a href="#" class="dataTable-sorter">Status</a></th><th data-sortable="" style="width: 25.886%;"><a href="#" class="dataTable-sorter">Customer</a></th><th data-sortable="" style="width: 29.4299%;"><a href="#" class="dataTable-sorter">Product</a></th><th data-sortable="" style="width: 15.2542%;"><a href="#" class="dataTable-sorter">Quantity</a></th><th data-sortable="" style="width: 14.3297%;"><a href="#" class="dataTable-sorter">Revenue</a></th><th data-sortable="" style="width: 9.1849%;"><a href="#" class="dataTable-sorter">Action</a></th></tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <a href="/vendor/dashboard/orders/{{order.id}}/"><tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <p class="text-xs font-weight-bold ms-2 mb-0">#{{order.id}}</p>
                                        </div>
                                    </td>
                                    <td class="font-weight-bold">
                                        <span class="my-2 text-xs">{{ order.creation_date|date:"d M, Y"}}</span>
                                    </td>
                                    <td class="text-xs font-weight-bold">
                                        <div class="d-flex align-items-center">
                                            {% for booking_order in booking_orders %}
                                                {% if booking_order.food_and_drinks == order %}
                                                    {% if booking_order.booking.payment.status.status == 'PAID' %}
                                                        <button class="btn btn-icon-only btn-rounded btn-outline-success mb-0 me-2 btn-sm d-flex align-items-center justify-content-center"><i class="fas fa-check" aria-hidden="true"></i></button>
                                                    {% elif booking_order.booking.payment.status.status == 'REFUNDED' %}
                                                        <button class="btn btn-icon-only btn-rounded btn-outline-danger mb-0 me-2 btn-sm d-flex align-items-center justify-content-center"><i class="fas fa-times" aria-hidden="true"></i></button>
                                                    {% else %}
                                                        <button class="btn btn-icon-only btn-rounded btn-outline-warning mb-0 me-2 btn-sm d-flex align-items-center justify-content-center"><i class="fas fa-exclamation" aria-hidden="true"></i></button>
                                                    {% endif %}
                                                    {% if booking_order.booking.payment.status.status %}
                                                        <span>{{ booking_order.booking.payment.status.status }}</span>
                                                    {% else %}
                                                        <span>UNKNOWN</span>
                                                    {% endif %}
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td class="text-xs font-weight-bold">
                                        <div class="d-flex align-items-center">
                                            {% if order.user.avatar %}<img src="{{ order.user.avatar.url}}" class="avatar avatar-xs me-2" alt="user image">{%else%}<img src="https://api.dicebear.com/6.x/initials/svg?seed={{user.first_name}}&randomizeIds=true" class="avatar avatar-xs me-2" alt="user image">{%endif%}
                                            <span>{{ order.user.first_name }} {{ order.user.last_name }}</span>
                                        </div>
                                    </td>
                                    <td class="text-xs font-weight-bold">
                                        <span class="my-2 text-xs">{{ order.item.food_and_drinks_item.name }}</span>
                                    </td>
                                    <td class="text-xs font-weight-bold">
                                        <span class="my-2 text-xs">{{ order.quantity }}</span>
                                    </td>
                                    <td class="text-xs font-weight-bold">
                                        <span class="my-2 text-xs">${{ order.item.food_and_drinks_item.price|multiply:order.quantity }}</span>
                                    </td>
                                    <td class="text-sm">
                                        <a href="/vendor/dashboard/orders/{{order.id}}/" data-bs-toggle="tooltip" data-bs-original-title="View Order">
                                            <i class="fas fa-eye text-secondary" aria-hidden="true"></i>
                                        </a>
                                    </td>
                                </tr></a>
                            {% endfor %}
                        </tbody>
                    </table></div><div class="dataTable-bottom"><div class="dataTable-info">Showing 1 to 10 of 12 entries</div><nav class="dataTable-pagination"><ul class="dataTable-pagination-list"><li class="pager"><a href="#" data-page="1">‹</a></li><li class="active"><a href="#" data-page="1">1</a></li><li class=""><a href="#" data-page="2">2</a></li><li class="pager"><a href="#" data-page="2">›</a></li></ul></nav></div></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const dataTableSearch = new simpleDatatables.DataTable("#datatable-search", {
        searchable: true,
        fixedHeight: false,
        perPageSelect: false
    });
    
    document.querySelectorAll(".export").forEach(function(el) {
        el.addEventListener("click", function(e) {
            var type = el.dataset.type;
            
            var data = {
                type: type,
                filename: "soft-ui-" + type,
            };
            
            if (type === "csv") {
                data.columnDelimiter = "|";
            }
            
            dataTableSearch.export(data);
        });
    });
</script>

{% endblock %}